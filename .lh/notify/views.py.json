{
    "sourceFile": "notify/views.py",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 8,
            "patches": [
                {
                    "date": 1739869347719,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1739869355671,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,9 +2,9 @@\n from rest_framework.response import Response\n from rest_framework.permissions import IsAuthenticated\n from .models import Notification\n from .serializers import NotificationSerializer\n-from .permissions import DynamicModelPermission\n+from ..permissions import DynamicModelPermission\n \n class NotificationViewSet(viewsets.ModelViewSet):\n     \"\"\"\n     API for managing notifications.\n"
                },
                {
                    "date": 1739869362572,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,9 +2,9 @@\n from rest_framework.response import Response\n from rest_framework.permissions import IsAuthenticated\n from .models import Notification\n from .serializers import NotificationSerializer\n-from ..permissions import DynamicModelPermission\n+from mainproj.permissions import DynamicModelPermission\n \n class NotificationViewSet(viewsets.ModelViewSet):\n     \"\"\"\n     API for managing notifications.\n"
                },
                {
                    "date": 1739869736001,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,31 +2,28 @@\n from rest_framework.response import Response\n from rest_framework.permissions import IsAuthenticated\n from .models import Notification\n from .serializers import NotificationSerializer\n-from mainproj.permissions import DynamicModelPermission\n+from .permissions import DynamicModelPermission\n \n class NotificationViewSet(viewsets.ModelViewSet):\n     \"\"\"\n     API for managing notifications.\n-    - Users can only see their own notifications.\n-    - Superusers can see all notifications.\n-    - Users can mark notifications as read.\n     \"\"\"\n     serializer_class = NotificationSerializer\n     permission_classes = [IsAuthenticated, DynamicModelPermission]\n \n     def get_queryset(self):\n         \"\"\"\n-        Fetch only notifications related to the user.\n+        Users only see notifications related to their actions.\n         \"\"\"\n         if self.request.user.is_superuser:\n             return Notification.objects.all().order_by(\"-created_at\")\n         return Notification.objects.filter(user=self.request.user).order_by(\"-created_at\")\n \n     def update(self, request, *args, **kwargs):\n         \"\"\"\n-        Mark a notification as read.\n+        Allow users to mark notifications as read.\n         \"\"\"\n         instance = self.get_object()\n         if instance.user != request.user:\n             return Response({\"detail\": \"Not allowed\"}, status=status.HTTP_403_FORBIDDEN)\n"
                },
                {
                    "date": 1739869741526,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,9 +2,9 @@\n from rest_framework.response import Response\n from rest_framework.permissions import IsAuthenticated\n from .models import Notification\n from .serializers import NotificationSerializer\n-from .permissions import DynamicModelPermission\n+from main.permissions import DynamicModelPermission\n \n class NotificationViewSet(viewsets.ModelViewSet):\n     \"\"\"\n     API for managing notifications.\n"
                },
                {
                    "date": 1739870603394,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,31 +2,26 @@\n from rest_framework.response import Response\n from rest_framework.permissions import IsAuthenticated\n from .models import Notification\n from .serializers import NotificationSerializer\n-from main.permissions import DynamicModelPermission\n \n class NotificationViewSet(viewsets.ModelViewSet):\n     \"\"\"\n     API for managing notifications.\n+    - Users only see their own notifications.\n+    - Superusers can see all notifications.\n     \"\"\"\n     serializer_class = NotificationSerializer\n-    permission_classes = [IsAuthenticated, DynamicModelPermission]\n+    permission_classes = [IsAuthenticated]\n \n     def get_queryset(self):\n-        \"\"\"\n-        Users only see notifications related to their actions.\n-        \"\"\"\n         if self.request.user.is_superuser:\n-            return Notification.objects.all().order_by(\"-created_at\")\n-        return Notification.objects.filter(user=self.request.user).order_by(\"-created_at\")\n+            return Notification.objects.all().order_by(\"-timestamp\")\n+        return Notification.objects.filter(user=self.request.user).order_by(\"-timestamp\")\n \n     def update(self, request, *args, **kwargs):\n-        \"\"\"\n-        Allow users to mark notifications as read.\n-        \"\"\"\n         instance = self.get_object()\n-        if instance.user != request.user:\n+        if request.user != instance.user:\n             return Response({\"detail\": \"Not allowed\"}, status=status.HTTP_403_FORBIDDEN)\n \n         instance.is_read = True\n         instance.save()\n"
                },
                {
                    "date": 1740121020520,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,28 +1,28 @@\n-from rest_framework import viewsets, status\n-from rest_framework.response import Response\n-from rest_framework.permissions import IsAuthenticated\n-from .models import Notification\n-from .serializers import NotificationSerializer\n+# from rest_framework import viewsets, status\n+# from rest_framework.response import Response\n+# from rest_framework.permissions import IsAuthenticated\n+# from .models import Notification\n+# from .serializers import NotificationSerializer\n \n-class NotificationViewSet(viewsets.ModelViewSet):\n-    \"\"\"\n-    API for managing notifications.\n-    - Users only see their own notifications.\n-    - Superusers can see all notifications.\n-    \"\"\"\n-    serializer_class = NotificationSerializer\n-    permission_classes = [IsAuthenticated]\n+# class NotificationViewSet(viewsets.ModelViewSet):\n+#     \"\"\"\n+#     API for managing notifications.\n+#     - Users only see their own notifications.\n+#     - Superusers can see all notifications.\n+#     \"\"\"\n+#     serializer_class = NotificationSerializer\n+#     permission_classes = [IsAuthenticated]\n \n-    def get_queryset(self):\n-        if self.request.user.is_superuser:\n-            return Notification.objects.all().order_by(\"-timestamp\")\n-        return Notification.objects.filter(user=self.request.user).order_by(\"-timestamp\")\n+#     def get_queryset(self):\n+#         if self.request.user.is_superuser:\n+#             return Notification.objects.all().order_by(\"-timestamp\")\n+#         return Notification.objects.filter(user=self.request.user).order_by(\"-timestamp\")\n \n-    def update(self, request, *args, **kwargs):\n-        instance = self.get_object()\n-        if request.user != instance.user:\n-            return Response({\"detail\": \"Not allowed\"}, status=status.HTTP_403_FORBIDDEN)\n+#     def update(self, request, *args, **kwargs):\n+#         instance = self.get_object()\n+#         if request.user != instance.user:\n+#             return Response({\"detail\": \"Not allowed\"}, status=status.HTTP_403_FORBIDDEN)\n \n-        instance.is_read = True\n-        instance.save()\n-        return Response({\"message\": \"Notification marked as read\"}, status=status.HTTP_200_OK)\n+#         instance.is_read = True\n+#         instance.save()\n+#         return Response({\"message\": \"Notification marked as read\"}, status=status.HTTP_200_OK)\n"
                },
                {
                    "date": 1740121026245,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,28 +1,28 @@\n-# from rest_framework import viewsets, status\n-# from rest_framework.response import Response\n-# from rest_framework.permissions import IsAuthenticated\n-# from .models import Notification\n-# from .serializers import NotificationSerializer\n+from rest_framework import viewsets, status\n+from rest_framework.response import Response\n+from rest_framework.permissions import IsAuthenticated\n+from .models import Notification\n+from .serializers import NotificationSerializer\n \n-# class NotificationViewSet(viewsets.ModelViewSet):\n-#     \"\"\"\n-#     API for managing notifications.\n-#     - Users only see their own notifications.\n-#     - Superusers can see all notifications.\n-#     \"\"\"\n-#     serializer_class = NotificationSerializer\n-#     permission_classes = [IsAuthenticated]\n+class NotificationViewSet(viewsets.ModelViewSet):\n+    \"\"\"\n+    API for managing notifications.\n+    - Users only see their own notifications.\n+    - Superusers can see all notifications.\n+    \"\"\"\n+    serializer_class = NotificationSerializer\n+    permission_classes = [IsAuthenticated]\n \n-#     def get_queryset(self):\n-#         if self.request.user.is_superuser:\n-#             return Notification.objects.all().order_by(\"-timestamp\")\n-#         return Notification.objects.filter(user=self.request.user).order_by(\"-timestamp\")\n+    def get_queryset(self):\n+        if self.request.user.is_superuser:\n+            return Notification.objects.all().order_by(\"-timestamp\")\n+        return Notification.objects.filter(user=self.request.user).order_by(\"-timestamp\")\n \n-#     def update(self, request, *args, **kwargs):\n-#         instance = self.get_object()\n-#         if request.user != instance.user:\n-#             return Response({\"detail\": \"Not allowed\"}, status=status.HTTP_403_FORBIDDEN)\n+    def update(self, request, *args, **kwargs):\n+        instance = self.get_object()\n+        if request.user != instance.user:\n+            return Response({\"detail\": \"Not allowed\"}, status=status.HTTP_403_FORBIDDEN)\n \n-#         instance.is_read = True\n-#         instance.save()\n-#         return Response({\"message\": \"Notification marked as read\"}, status=status.HTTP_200_OK)\n+        instance.is_read = True\n+        instance.save()\n+        return Response({\"message\": \"Notification marked as read\"}, status=status.HTTP_200_OK)\n"
                },
                {
                    "date": 1740121129305,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,28 +1,50 @@\n from rest_framework import viewsets, status\n from rest_framework.response import Response\n from rest_framework.permissions import IsAuthenticated\n+from rest_framework.decorators import action\n from .models import Notification\n from .serializers import NotificationSerializer\n \n class NotificationViewSet(viewsets.ModelViewSet):\n     \"\"\"\n     API for managing notifications.\n     - Users only see their own notifications.\n     - Superusers can see all notifications.\n+    - Users can mark notifications as read.\n+    - Users can delete their own notifications.\n+    - Superusers can delete all notifications.\n     \"\"\"\n     serializer_class = NotificationSerializer\n     permission_classes = [IsAuthenticated]\n \n     def get_queryset(self):\n+        \"\"\"Return notifications based on user role.\"\"\"\n         if self.request.user.is_superuser:\n             return Notification.objects.all().order_by(\"-timestamp\")\n         return Notification.objects.filter(user=self.request.user).order_by(\"-timestamp\")\n \n     def update(self, request, *args, **kwargs):\n+        \"\"\"Mark a single notification as read.\"\"\"\n         instance = self.get_object()\n         if request.user != instance.user:\n             return Response({\"detail\": \"Not allowed\"}, status=status.HTTP_403_FORBIDDEN)\n \n         instance.is_read = True\n         instance.save()\n         return Response({\"message\": \"Notification marked as read\"}, status=status.HTTP_200_OK)\n+\n+    @action(detail=False, methods=[\"POST\"])\n+    def mark_all_as_read(self, request):\n+        \"\"\"Mark all notifications as read for the requesting user.\"\"\"\n+        notifications = Notification.objects.filter(user=request.user, is_read=False)\n+        notifications.update(is_read=True)\n+        return Response({\"message\": \"All notifications marked as read\"}, status=status.HTTP_200_OK)\n+\n+    @action(detail=False, methods=[\"DELETE\"])\n+    def delete_all(self, request):\n+        \"\"\"Delete all notifications for the requesting user.\"\"\"\n+        if request.user.is_superuser:\n+            Notification.objects.all().delete()\n+        else:\n+            Notification.objects.filter(user=request.user).delete()\n+        return Response({\"message\": \"All notifications deleted\"}, status=status.HTTP_200_OK)\n"
                }
            ],
            "date": 1739869347719,
            "name": "Commit-0",
            "content": "from rest_framework import viewsets, status\nfrom rest_framework.response import Response\nfrom rest_framework.permissions import IsAuthenticated\nfrom .models import Notification\nfrom .serializers import NotificationSerializer\nfrom .permissions import DynamicModelPermission\n\nclass NotificationViewSet(viewsets.ModelViewSet):\n    \"\"\"\n    API for managing notifications.\n    - Users can only see their own notifications.\n    - Superusers can see all notifications.\n    - Users can mark notifications as read.\n    \"\"\"\n    serializer_class = NotificationSerializer\n    permission_classes = [IsAuthenticated, DynamicModelPermission]\n\n    def get_queryset(self):\n        \"\"\"\n        Fetch only notifications related to the user.\n        \"\"\"\n        if self.request.user.is_superuser:\n            return Notification.objects.all().order_by(\"-created_at\")\n        return Notification.objects.filter(user=self.request.user).order_by(\"-created_at\")\n\n    def update(self, request, *args, **kwargs):\n        \"\"\"\n        Mark a notification as read.\n        \"\"\"\n        instance = self.get_object()\n        if instance.user != request.user:\n            return Response({\"detail\": \"Not allowed\"}, status=status.HTTP_403_FORBIDDEN)\n\n        instance.is_read = True\n        instance.save()\n        return Response({\"message\": \"Notification marked as read\"}, status=status.HTTP_200_OK)\n"
        }
    ]
}