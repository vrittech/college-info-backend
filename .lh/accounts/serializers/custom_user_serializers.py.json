{
    "sourceFile": "accounts/serializers/custom_user_serializers.py",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 11,
            "patches": [
                {
                    "date": 1728378543651,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1738219558783,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,136 +1,149 @@\n from rest_framework import serializers\n-from django.contrib.auth.models import Group,Permission\n-from ..models import CustomUser\n-from django.contrib.auth.hashers import make_password\n-from ...accountsmanagement import roles\n-from ..utilities.permission import SecureFields\n+from django.contrib.auth import get_user_model\n+# from department.models import Department\n+from django.contrib.auth.models import Group, Permission\n+from django.contrib.auth.hashers import check_password, make_password\n+# from socialmedia.models import SocialMedia,StaffHaveSocialMedia\n+from accounts.models import CustomUser\n \n-class CustomUserReadSerializer(serializers.ModelSerializer):\n+\n+User = get_user_model()\n+\n+# class SocialMediaSerializer(serializers.ModelSerializer):\n+#     class Meta:\n+#         model = SocialMedia\n+#         fields = ['id','name', 'url', 'media', 'created_at', 'updated_at' ]  # Adjust fields as per your SocialMedia model\n+\n+# class StaffSocialMediaSerializer(serializers.ModelSerializer):\n+#     social_media = SocialMediaSerializer(read_only=True)\n+\n+#     class Meta:\n+#         model = StaffHaveSocialMedia\n+#         fields = ['social_media', 'social_media_url','created_at', 'updated_at']\n+\n+class PermissionSerializer(serializers.ModelSerializer):\n     class Meta:\n-        ref_name =  \"account serializers\"\n-        model = CustomUser\n-        # fields = '__all__' \n-        exclude = ['password']\n+        ref_name = \"group\"\n+        model = Permission\n+        fields = ['id', 'name', 'codename']\n+        \n+class GroupSerializer(serializers.ModelSerializer):\n+    # permissions = PermissionSerializer(many=True, read_only=True)\n+    class Meta:\n+        model = Group\n+        fields = ['id', 'name']\n+        ref_name='user_groups'\n \n-class CustomUserReadLimitedSerializer(serializers.ModelSerializer):\n+# class DepartmentSerializer(serializers.ModelSerializer):\n+#     class Meta:\n+#         model = Department\n+#         fields = ['id','name']\n+\n+class CustomUserReadSerializer(serializers.ModelSerializer):\n+    # department = DepartmentSerializer(read_only = True)\n+    groups = GroupSerializer(many=True,read_only = True)\n+    # usersocial = StaffSocialMediaSerializer(many=True,read_only = True)\n     class Meta:\n-        ref_name =  \"CustomUserReadLimitedSerializer serializers\"\n-        model = CustomUser\n-        fields = ['id','email','first_name','username',] \n+        model = User\n+        fields = '__all__'\n+        \n+    \n \n-class CustomUserReadLimitedSerializer_1(serializers.ModelSerializer):\n+class CustomUserWriteSerializer(serializers.ModelSerializer):\n+    groups = serializers.PrimaryKeyRelatedField(queryset=Group.objects.all(), many=True, required=False)\n+    # usersocial = StaffSocialMediaSerializer(many=True, required=False)\n+    \n+\n     class Meta:\n-        ref_name =  \"CustomUserReadLimitedSerializer serializers\"\n-        model = CustomUser\n-        fields = ['id','email','first_name','username','last_name','role','getRoleName']\n+        model = User\n+        fields = '__all__'\n+        extra_kwargs = {\n+            'password': {'write_only': True}\n+        }\n+        \n+    def validate(self, data):\n+        # Check if the position already exists in another Career\n+        position = data.get('position')\n+        if position and CustomUser.objects.filter(position=position).exists():\n+            raise serializers.ValidationError({\"position\": \"A user with this position already exists.\"})\n+        return data\n \n+    def create(self, validated_data):\n+    groups = validated_data.pop('groups', [])\n+    social_media_data = validated_data.pop('social_media', [])\n+    password = validated_data.pop('password', None)\n \n-class CustomUserSerializer(serializers.ModelSerializer):\n+    # Create user\n+    user = User.objects.create(**validated_data)\n     \n-    def validate_password(self,value):#field level validation\n-        if len(value) < 5:\n-            raise serializers.ValidationError('Password must be 8 digit')\n-        return make_password(value) \n+    if password:\n+        user.set_password(password)\n+\n+    # Convert groups into primary keys if they are objects\n+    group_ids = [group.id if hasattr(group, 'id') else group for group in groups]\n     \n-    def validate_role(self,value):#field level validation\n-        user = self.context['request'].user\n-        # print(user.is_authenticated)\n-        if not user.is_authenticated:\n-            if value == roles.USER:\n-                pass\n-            else:\n-                raise serializers.ValidationError(\"You can only set USER,PUBLISHER as role\") \n-        elif user.role in [roles.ADMIN,roles.SUPER_ADMIN]:\n-            return value\n-        elif user.is_authenticated and value!=roles.USER:\n-                raise serializers.ValidationError(\"You can only set USER as role\") \n-        return value\n-    \n-    def validate_is_verified(self,value):\n+    user.groups.set(group_ids)  # ✅ Ensure only IDs are passed\n+    user.save()\n \n-        user = self.context['request'].user\n-        if user.is_authenticated:\n-            if user.role == roles.ADMIN:\n-                return value\n-            else:\n-                return False\n-        else:\n-            return False\n+    return user\n \n-    def validate_is_superuser(self,value):\n\\ No newline at end of file\n-        if value == True:\n-            raise serializers.ValidationError(\"You can not set USER as SYSTEM_ADMIN\") \n-        else:\n-            return False\n+        # # Create social media records\n+        # for sm_data in social_media_data:\n+        #     StaffHaveSocialMedia.objects.create(\n+        #         staff=user,\n+        #         social_media=sm_data['social_media'],\n+        #         social_media_url=sm_data['social_media_url']\n+        #     )\n \n-    def validate(self, attrs):\n-        request = self.context.get('request')\n-        action = self.context['view'].action     \n+        return user\n \n-        if action == 'partial_update':\n-            old_password = request.data.get('old_password')  \n-            if old_password is not None:      \n-                instance = self.instance\n-                if not instance.check_password(old_password):\n-                    raise serializers.ValidationError(\"Password does not match\")\n-            attrs['old_password_change_case'] = True\n-        return attrs        \n+    def update(self, instance, validated_data):\n+        groups = validated_data.pop('groups', [])\n+        social_media_data = validated_data.pop('social_media', [])\n+        password = validated_data.pop('password', None)\n \n-    def get_extra_kwargs(self):\n-        extra_kwargs = super().get_extra_kwargs()\n-        try:\n-            if self.context['request'].method == 'PUT':\n-                extra_kwargs['password'] = {'required': False}\n-            return extra_kwargs\n-        except:\n-            pass\n-    \n-    class Meta:\n-        ref_name =  \"accountWriteserializer\"\n-        model = CustomUser\n-        fields = '__all__' \n+        # Update user fields\n+        for attr, value in validated_data.items():\n+            setattr(instance, attr, value)\n \n+        if password:\n+            instance.set_password(password)\n+        instance.groups.set(groups)\n+        instance.save()\n \n-    def get_fields(self):\n-        model_fields = super().get_fields()\n-        SecureFields(self,model_fields,['email','is_active','is_verified','role','provider','username','is_superuser'],['PATCH','PUT'],[roles.ADMIN,roles.SUPER_ADMIN])\n-        # SecureFields(self,model_fields,['provider'],['PATCH','PUT'],[]) #if empty [] it means it is striction for all\n-        return model_fields\n+        # Update or create social media records\n+        # for sm_data in social_media_data:\n+        #     StaffHaveSocialMedia.objects.update_or_create(\n+        #         staff=instance,\n+        #         social_media=sm_data['social_media'],\n+        #         defaults={'social_media_url': sm_data['social_media_url']}\n+        #     )\n \n-class RoleSerializer(serializers.Serializer):\n-    role_id = serializers.IntegerField()\n-    role_name = serializers.CharField()\n-    def to_representation(self, instance):\n-        return {'role_id': instance[0], 'role_name': instance[1]}\n+        return instance\n \n-\n-class GroupSerializer(serializers.ModelSerializer):\n+class CustomUserRetrieveSerializer(serializers.ModelSerializer):\n+    # usersocial = StaffSocialMediaSerializer(many=True,read_only = True)\n+    groups = GroupSerializer(many=True,read_only = True)\n+    # department = DepartmentSerializer(read_only = True)\n     class Meta:\n-        model = Group\n-        fields = '__all__'  \n+        model = User\n+        fields =fields = '__all__'\n+        # ('roles', 'department', 'email', 'full_name', 'social_links', 'position', 'phone', 'avatar', 'professional_image', )\n \n-class PermissionSerializer(serializers.ModelSerializer):\n-    class Meta:\n-        model = Permission\n-        fields = '__all__'  \n+class CustomUserChangePasswordSerializers(serializers.Serializer):\n+    current_password = serializers.CharField(write_only=True)\n+    new_password = serializers.CharField(write_only=True)\n \n-class LoginSerializer(serializers.Serializer):\n-    email = serializers.EmailField()\n-    username = serializers.CharField()\n-    password = serializers.CharField()\n+    def validate(self, data):\n+        user = self.context['request'].user\n+        # Check if current password is correct\n+        if not check_password(data['current_password'], user.password):\n+            raise serializers.ValidationError({\"current_password\": \"Current password is incorrect\"})\n+        return data\n \n-class GroupNamesSerializer(serializers.Serializer):\n-    group_names = serializers.ListField(child=serializers.CharField())\n+    def validate_new_password(self, value):\n+        if len(value) < 8:\n+            raise serializers.ValidationError(\"Password must be at least 8 characters long\")\n+        return value\n \n-class PermissionGroupSerializer(serializers.Serializer):\n-    permission_id = serializers.IntegerField()\n-    groups = serializers.DictField(child=serializers.BooleanField())\n-\n-\n-class UserDetailsSerializer(serializers.ModelSerializer):\n-    class Meta:\n-        model = CustomUser\n-        fields = ['id', 'full_name', 'phone', 'image', 'email']\n-    \n-  \n-    \n+   \n\\ No newline at end of file\n"
                },
                {
                    "date": 1738219566661,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -68,25 +68,24 @@\n             raise serializers.ValidationError({\"position\": \"A user with this position already exists.\"})\n         return data\n \n     def create(self, validated_data):\n-    groups = validated_data.pop('groups', [])\n-    social_media_data = validated_data.pop('social_media', [])\n-    password = validated_data.pop('password', None)\n+        groups = validated_data.pop('groups', [])\n+        social_media_data = validated_data.pop('social_media', [])\n+        password = validated_data.pop('password', None)\n \n-    # Create user\n-    user = User.objects.create(**validated_data)\n-    \n-    if password:\n-        user.set_password(password)\n+        # Create user\n+        user = User.objects.create(**validated_data)\n+        \n+        if password:\n+            user.set_password(password)\n \n-    # Convert groups into primary keys if they are objects\n-    group_ids = [group.id if hasattr(group, 'id') else group for group in groups]\n-    \n-    user.groups.set(group_ids)  # ✅ Ensure only IDs are passed\n-    user.save()\n+        # Convert groups into primary keys if they are objects\n+        group_ids = [group.id if hasattr(group, 'id') else group for group in groups]\n+        \n+        user.groups.set(group_ids)  # ✅ Ensure only IDs are passed\n+        user.save()\n \n-    return user\n \n         # # Create social media records\n         # for sm_data in social_media_data:\n         #     StaffHaveSocialMedia.objects.create(\n"
                },
                {
                    "date": 1738219687766,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -96,31 +96,27 @@\n \n         return user\n \n     def update(self, instance, validated_data):\n-        groups = validated_data.pop('groups', [])\n-        social_media_data = validated_data.pop('social_media', [])\n-        password = validated_data.pop('password', None)\n+    groups = validated_data.pop('groups', [])\n+    social_media_data = validated_data.pop('social_media', [])\n+    password = validated_data.pop('password', None)\n \n-        # Update user fields\n-        for attr, value in validated_data.items():\n-            setattr(instance, attr, value)\n+    # Update user fields\n+    for attr, value in validated_data.items():\n+        setattr(instance, attr, value)\n \n-        if password:\n-            instance.set_password(password)\n-        instance.groups.set(groups)\n-        instance.save()\n+    if password:\n+        instance.set_password(password)\n \n-        # Update or create social media records\n-        # for sm_data in social_media_data:\n-        #     StaffHaveSocialMedia.objects.update_or_create(\n-        #         staff=instance,\n-        #         social_media=sm_data['social_media'],\n-        #         defaults={'social_media_url': sm_data['social_media_url']}\n-        #     )\n+    # Convert groups into primary keys if they are objects\n+    group_ids = [group.id if hasattr(group, 'id') else group for group in groups]\n \n-        return instance\n+    instance.groups.set(group_ids)  # ✅ Ensure only IDs are passed\n+    instance.save()\n \n+    return instance\n+\n class CustomUserRetrieveSerializer(serializers.ModelSerializer):\n     # usersocial = StaffSocialMediaSerializer(many=True,read_only = True)\n     groups = GroupSerializer(many=True,read_only = True)\n     # department = DepartmentSerializer(read_only = True)\n"
                },
                {
                    "date": 1738219789457,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -68,54 +68,45 @@\n             raise serializers.ValidationError({\"position\": \"A user with this position already exists.\"})\n         return data\n \n     def create(self, validated_data):\n-        groups = validated_data.pop('groups', [])\n-        social_media_data = validated_data.pop('social_media', [])\n-        password = validated_data.pop('password', None)\n+    groups = validated_data.pop('groups', [])\n+    social_media_data = validated_data.pop('social_media', [])\n+    password = validated_data.pop('password', None)\n \n-        # Create user\n-        user = User.objects.create(**validated_data)\n-        \n-        if password:\n-            user.set_password(password)\n+    # Create user\n+    user = User.objects.create(**validated_data)\n+    \n+    if password:\n+        user.set_password(password)\n \n-        # Convert groups into primary keys if they are objects\n+    # Ensure groups only contain IDs\n+    if groups:\n         group_ids = [group.id if hasattr(group, 'id') else group for group in groups]\n-        \n-        user.groups.set(group_ids)  # ✅ Ensure only IDs are passed\n-        user.save()\n+        user.groups.set(group_ids)  # ✅ Corrected usage\n \n+    user.save()\n+    return user\n \n-        # # Create social media records\n-        # for sm_data in social_media_data:\n-        #     StaffHaveSocialMedia.objects.create(\n-        #         staff=user,\n-        #         social_media=sm_data['social_media'],\n-        #         social_media_url=sm_data['social_media_url']\n-        #     )\n-\n-        return user\n-\n     def update(self, instance, validated_data):\n-    groups = validated_data.pop('groups', [])\n-    social_media_data = validated_data.pop('social_media', [])\n-    password = validated_data.pop('password', None)\n+        groups = validated_data.pop('groups', [])\n+        social_media_data = validated_data.pop('social_media', [])\n+        password = validated_data.pop('password', None)\n \n-    # Update user fields\n-    for attr, value in validated_data.items():\n-        setattr(instance, attr, value)\n+        # Update user fields\n+        for attr, value in validated_data.items():\n+            setattr(instance, attr, value)\n \n-    if password:\n-        instance.set_password(password)\n+        if password:\n+            instance.set_password(password)\n \n-    # Convert groups into primary keys if they are objects\n-    group_ids = [group.id if hasattr(group, 'id') else group for group in groups]\n+        # Convert groups into primary keys if they are objects\n+        group_ids = [group.id if hasattr(group, 'id') else group for group in groups]\n \n-    instance.groups.set(group_ids)  # ✅ Ensure only IDs are passed\n-    instance.save()\n+        instance.groups.set(group_ids)  # ✅ Ensure only IDs are passed\n+        instance.save()\n \n-    return instance\n+        return instance\n \n class CustomUserRetrieveSerializer(serializers.ModelSerializer):\n     # usersocial = StaffSocialMediaSerializer(many=True,read_only = True)\n     groups = GroupSerializer(many=True,read_only = True)\n"
                },
                {
                    "date": 1738219810660,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -68,25 +68,25 @@\n             raise serializers.ValidationError({\"position\": \"A user with this position already exists.\"})\n         return data\n \n     def create(self, validated_data):\n-    groups = validated_data.pop('groups', [])\n-    social_media_data = validated_data.pop('social_media', [])\n-    password = validated_data.pop('password', None)\n+        groups = validated_data.pop('groups', [])\n+        social_media_data = validated_data.pop('social_media', [])\n+        password = validated_data.pop('password', None)\n \n-    # Create user\n-    user = User.objects.create(**validated_data)\n-    \n-    if password:\n-        user.set_password(password)\n+        # Create user\n+        user = User.objects.create(**validated_data)\n+        \n+        if password:\n+            user.set_password(password)\n \n-    # Ensure groups only contain IDs\n-    if groups:\n-        group_ids = [group.id if hasattr(group, 'id') else group for group in groups]\n-        user.groups.set(group_ids)  # ✅ Corrected usage\n+        # Ensure groups only contain IDs\n+        if groups:\n+            group_ids = [group.id if hasattr(group, 'id') else group for group in groups]\n+            user.groups.set(group_ids)  \n \n-    user.save()\n-    return user\n+        user.save()\n+        return user\n \n     def update(self, instance, validated_data):\n         groups = validated_data.pop('groups', [])\n         social_media_data = validated_data.pop('social_media', [])\n"
                },
                {
                    "date": 1738219817428,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -80,8 +80,9 @@\n             user.set_password(password)\n \n         # Ensure groups only contain IDs\n         if groups:\n+            print(groups)\n             group_ids = [group.id if hasattr(group, 'id') else group for group in groups]\n             user.groups.set(group_ids)  \n \n         user.save()\n"
                },
                {
                    "date": 1738219824489,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -80,9 +80,9 @@\n             user.set_password(password)\n \n         # Ensure groups only contain IDs\n         if groups:\n-            print(groups)\n+            print(groups,\"!!!!!!!!!!!!!!!!!!!!\")\n             group_ids = [group.id if hasattr(group, 'id') else group for group in groups]\n             user.groups.set(group_ids)  \n \n         user.save()\n"
                },
                {
                    "date": 1738219851653,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -69,8 +69,9 @@\n         return data\n \n     def create(self, validated_data):\n         groups = validated_data.pop('groups', [])\n+        \n         social_media_data = validated_data.pop('social_media', [])\n         password = validated_data.pop('password', None)\n \n         # Create user\n"
                },
                {
                    "date": 1738219858192,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -69,9 +69,9 @@\n         return data\n \n     def create(self, validated_data):\n         groups = validated_data.pop('groups', [])\n-        \n+        print(groups,\"!!!!!!!!!!!!!!!!!!!!\")\n         social_media_data = validated_data.pop('social_media', [])\n         password = validated_data.pop('password', None)\n \n         # Create user\n"
                },
                {
                    "date": 1738219865908,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -69,9 +69,9 @@\n         return data\n \n     def create(self, validated_data):\n         groups = validated_data.pop('groups', [])\n-        print(groups,\"!!!!!!!!!!!!!!!!!!!!\")\n+        print(groups,\"---------------------\")\n         social_media_data = validated_data.pop('social_media', [])\n         password = validated_data.pop('password', None)\n \n         # Create user\n"
                },
                {
                    "date": 1738220003260,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -67,48 +67,48 @@\n         if position and CustomUser.objects.filter(position=position).exists():\n             raise serializers.ValidationError({\"position\": \"A user with this position already exists.\"})\n         return data\n \n-    def create(self, validated_data):\n-        groups = validated_data.pop('groups', [])\n-        print(groups,\"---------------------\")\n-        social_media_data = validated_data.pop('social_media', [])\n-        password = validated_data.pop('password', None)\n+    # def create(self, validated_data):\n+    #     groups = validated_data.pop('groups', [])\n+    #     print(groups,\"---------------------\")\n+    #     social_media_data = validated_data.pop('social_media', [])\n+    #     password = validated_data.pop('password', None)\n \n-        # Create user\n-        user = User.objects.create(**validated_data)\n+    #     # Create user\n+    #     user = User.objects.create(**validated_data)\n         \n-        if password:\n-            user.set_password(password)\n+    #     if password:\n+    #         user.set_password(password)\n \n-        # Ensure groups only contain IDs\n-        if groups:\n-            print(groups,\"!!!!!!!!!!!!!!!!!!!!\")\n-            group_ids = [group.id if hasattr(group, 'id') else group for group in groups]\n-            user.groups.set(group_ids)  \n+    #     # Ensure groups only contain IDs\n+    #     if groups:\n+    #         print(groups,\"!!!!!!!!!!!!!!!!!!!!\")\n+    #         group_ids = [group.id if hasattr(group, 'id') else group for group in groups]\n+    #         user.groups.set(group_ids)  \n \n-        user.save()\n-        return user\n+    #     user.save()\n+    #     return user\n \n-    def update(self, instance, validated_data):\n-        groups = validated_data.pop('groups', [])\n-        social_media_data = validated_data.pop('social_media', [])\n-        password = validated_data.pop('password', None)\n+    # def update(self, instance, validated_data):\n+    #     groups = validated_data.pop('groups', [])\n+    #     social_media_data = validated_data.pop('social_media', [])\n+    #     password = validated_data.pop('password', None)\n \n-        # Update user fields\n-        for attr, value in validated_data.items():\n-            setattr(instance, attr, value)\n+    #     # Update user fields\n+    #     for attr, value in validated_data.items():\n+    #         setattr(instance, attr, value)\n \n-        if password:\n-            instance.set_password(password)\n+    #     if password:\n+    #         instance.set_password(password)\n \n-        # Convert groups into primary keys if they are objects\n-        group_ids = [group.id if hasattr(group, 'id') else group for group in groups]\n+    #     # Convert groups into primary keys if they are objects\n+    #     group_ids = [group.id if hasattr(group, 'id') else group for group in groups]\n \n-        instance.groups.set(group_ids)  # ✅ Ensure only IDs are passed\n-        instance.save()\n+    #     instance.groups.set(group_ids)  # ✅ Ensure only IDs are passed\n+    #     instance.save()\n \n-        return instance\n+    #     return instance\n \n class CustomUserRetrieveSerializer(serializers.ModelSerializer):\n     # usersocial = StaffSocialMediaSerializer(many=True,read_only = True)\n     groups = GroupSerializer(many=True,read_only = True)\n"
                }
            ],
            "date": 1728378543651,
            "name": "Commit-0",
            "content": "from rest_framework import serializers\nfrom django.contrib.auth.models import Group,Permission\nfrom ..models import CustomUser\nfrom django.contrib.auth.hashers import make_password\nfrom ...accountsmanagement import roles\nfrom ..utilities.permission import SecureFields\n\nclass CustomUserReadSerializer(serializers.ModelSerializer):\n    class Meta:\n        ref_name =  \"account serializers\"\n        model = CustomUser\n        # fields = '__all__' \n        exclude = ['password']\n\nclass CustomUserReadLimitedSerializer(serializers.ModelSerializer):\n    class Meta:\n        ref_name =  \"CustomUserReadLimitedSerializer serializers\"\n        model = CustomUser\n        fields = ['id','email','first_name','username',] \n\nclass CustomUserReadLimitedSerializer_1(serializers.ModelSerializer):\n    class Meta:\n        ref_name =  \"CustomUserReadLimitedSerializer serializers\"\n        model = CustomUser\n        fields = ['id','email','first_name','username','last_name','role','getRoleName']\n\n\nclass CustomUserSerializer(serializers.ModelSerializer):\n    \n    def validate_password(self,value):#field level validation\n        if len(value) < 5:\n            raise serializers.ValidationError('Password must be 8 digit')\n        return make_password(value) \n    \n    def validate_role(self,value):#field level validation\n        user = self.context['request'].user\n        # print(user.is_authenticated)\n        if not user.is_authenticated:\n            if value == roles.USER:\n                pass\n            else:\n                raise serializers.ValidationError(\"You can only set USER,PUBLISHER as role\") \n        elif user.role in [roles.ADMIN,roles.SUPER_ADMIN]:\n            return value\n        elif user.is_authenticated and value!=roles.USER:\n                raise serializers.ValidationError(\"You can only set USER as role\") \n        return value\n    \n    def validate_is_verified(self,value):\n\n        user = self.context['request'].user\n        if user.is_authenticated:\n            if user.role == roles.ADMIN:\n                return value\n            else:\n                return False\n        else:\n            return False\n\n    def validate_is_superuser(self,value):\n        if value == True:\n            raise serializers.ValidationError(\"You can not set USER as SYSTEM_ADMIN\") \n        else:\n            return False\n\n    def validate(self, attrs):\n        request = self.context.get('request')\n        action = self.context['view'].action     \n\n        if action == 'partial_update':\n            old_password = request.data.get('old_password')  \n            if old_password is not None:      \n                instance = self.instance\n                if not instance.check_password(old_password):\n                    raise serializers.ValidationError(\"Password does not match\")\n            attrs['old_password_change_case'] = True\n        return attrs        \n\n    def get_extra_kwargs(self):\n        extra_kwargs = super().get_extra_kwargs()\n        try:\n            if self.context['request'].method == 'PUT':\n                extra_kwargs['password'] = {'required': False}\n            return extra_kwargs\n        except:\n            pass\n    \n    class Meta:\n        ref_name =  \"accountWriteserializer\"\n        model = CustomUser\n        fields = '__all__' \n\n\n    def get_fields(self):\n        model_fields = super().get_fields()\n        SecureFields(self,model_fields,['email','is_active','is_verified','role','provider','username','is_superuser'],['PATCH','PUT'],[roles.ADMIN,roles.SUPER_ADMIN])\n        # SecureFields(self,model_fields,['provider'],['PATCH','PUT'],[]) #if empty [] it means it is striction for all\n        return model_fields\n\nclass RoleSerializer(serializers.Serializer):\n    role_id = serializers.IntegerField()\n    role_name = serializers.CharField()\n    def to_representation(self, instance):\n        return {'role_id': instance[0], 'role_name': instance[1]}\n\n\nclass GroupSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = Group\n        fields = '__all__'  \n\nclass PermissionSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = Permission\n        fields = '__all__'  \n\nclass LoginSerializer(serializers.Serializer):\n    email = serializers.EmailField()\n    username = serializers.CharField()\n    password = serializers.CharField()\n\nclass GroupNamesSerializer(serializers.Serializer):\n    group_names = serializers.ListField(child=serializers.CharField())\n\nclass PermissionGroupSerializer(serializers.Serializer):\n    permission_id = serializers.IntegerField()\n    groups = serializers.DictField(child=serializers.BooleanField())\n\n\nclass UserDetailsSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = CustomUser\n        fields = ['id', 'full_name', 'phone', 'image', 'email']\n    \n  \n    "
        }
    ]
}